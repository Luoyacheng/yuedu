[{
  "bookSourceComment": "┍　　　说明　　　作者：洛娅橙　　┒\n├────────────────┤\n│书源默认优化正文加载，可能会导致│\n│下载书籍异常，在该登录界面点击启│\n│用下载即可。支持屏蔽书籍为黑名单│\n│之后在搜索和发现不再显示屏蔽后的│\n│书籍（误点击时再次点击可恢复）　│\n├────────────────┤\n│　　　　　　　　　　　　　　　　│\n│·强烈建议使用阅读最新测试版　　│\n└────────────────┘\n┍　　　　书源作者：洛娅橙　　　　┒\n├───┬────────────┤\n│！免责│本书源只提供代码进行技术│\n│！声明│交流，请于２４小时后删除│\n├───┴────────────┤\n│八叉现目前支持免费注册，可在书源│\n│登录界面进行登录。　　　　　　　│\n│搜索关键词输入示意：　　　　　　│\n│我的、书名：系统、作者：棺材、　│\n│标签：母女。　　　　　　　　　　│\n│书籍变量可用来进行交互，详情查看│\n│对应界面的变量说明　　　　　　　│\n└────────────────┘\n___________________________________________\n1.2.8版，新增书籍黑名单，日志不再记录在书源\n1.2.6版，详情页刷新，无新内容不刷新目录\n八叉发布页：https://8xsk.org\nip地址查看：https://iplark.com",
  "bookSourceGroup": "🙈",
  "bookSourceName": "🌈八叉书库",
  "bookSourceType": 0,
  "bookSourceUrl": "洛娅橙-八叉书库",
  "bookUrlPattern": "https://www.(?:\\d+\\.xyz|8xbook.+)/book/\\d+\\.html",
  "concurrentRate": "1000",
  "coverDecodeJs": "",
  "customOrder": 0,
  "enabled": true,
  "enabledCookieJar": false,
  "enabledExplore": true,
  "exploreUrl": "@js:\nlet banben = '1.2.9';\neval(String(source.loginUrl));\nlet surl = String(source.getVariable()).replace(/\\/$/,'');\n\nvar obj = {\n\t最近更: {\n\t\t\"url\": \"/sort/0/{{page}}.html\",\n\t\t\"fg\": 9},\n\t\t'新(肉)':{\n\t\t\"url\": \"/sort/7/{{page}}.html\",\n\t\t\"fg\": 1},\n\t最近入库: {\n\t\t\"url\": \"/top/postdate/{{page}}.html\",\n\t\t\"fg\": 10},\n\t\t\n\t最近完: {\n\t\t\"url\": \"/modules/article/articlelist.php?fullflag=1&page={{page}}\",\n\t\t\"fg\": 9,\n\t\t\"wrap\": true},\n\t\t'结(肉)':{\n\t\t\"url\": \"/modules/article/articlelist.php?sortid=7&fullflag=1&page={{page}}\",\n\t\t\"fg\": 1},\n\t签约新书: {\n\t\t\"url\": \"/top/signtime/{{page}}.html\",\n\t\t\"fg\": 10},\n\t\t\n\t字数榜: {\n\t\t\"url\": \"/top/words/{{page}}.html\",\n\t\t\"wb\": true},\n\t收藏榜: {\n\t\t\"url\": \"/top/goodnum/{{page}}.html\"},\n\t新书榜: {\n\t\t\"url\": \"/top/newhot/{{page}}.html\"},\n\t\t\n\t总点击: {\n\t\t\"url\": \"/top/allvisit/{{page}}.html\",\n\t\t\"wb\": true},\n\t月点击: {\n\t\t\"url\": \"/top/monthvisit/{{page}}.html\"},\n\t周点击: {\n\t\t\"url\": \"/top/weekvisit/{{page}}.html\"},\n\t\t\n\t总推荐: {\n\t\t\"url\": \"/top/allvote/{{page}}.html\",\n\t\t\"wb\": true},\n\t月推荐: {\n\t\t\"url\": \"/top/monthvote/{{page}}.html\"},\n\t周推荐: {\n\t\t\"url\": \"/top/weekvote/{{page}}.html\"},\n\t\t搜索: {\n\t\t\turl: \t`{{\n\t\t\t\tnn=source.getVariable()\n\t\t\t\tsurll = String(nn)\n\t\t\t\tsurl=surll.replace(/\\\\/$/,'');\n\t\t\t\tif (page == 1) {\n\t\t\t\t\ttry {\n\t\t\t\t\tsvg='<svg width=\"990\" height=\"300\" xmlns=\"http://www.w3.org/2000/svg\"><text fill=\"#a2a9b6\" text-anchor=\"middle\" dominant-baseline=\"middle\" stroke=\"#000000\" stroke-width=\"1\" font-weight=\"bold\"><tspan x=\"50%\" dy=\"30%\" font-size=\"100\">请输入搜索关键词</tspan><tspan x=\"50%\" dy=\"50%\" font-size=\"50\">此处搜索不支持完整书名</tspan></text></svg>';\n\tsvg=java.base64Encode(svg);\n\tkeyy=java.getVerificationCode('data:image/svg+xml;base64,'+svg);\n\t\t\t\t\t} catch(err) {keyy='系统';\n\t\t\t\t\tPackages.java.lang.Thread.sleep(500);\n\t\t\t\t\tjava.toast('使用默认关键词“系统”');}\n\t\t\t\t\tsource.put('keyy',keyy);\n\t\t\t\t\t\t}\n\t\t\t\telse keyy = source.get('keyy');\n\t\t\t\turl =\tsurl+'/modules/article/search.php?searchkey='+keyy+'&searchtype=all&page='+page;\n\t\t\t\turl\n\t\t\t}}`,\n\t\t\t\"wb\": true}\n\t}\n\nvar sort = [];\npush = (title, url, size, wrap) => sort.push({\n    \"title\": title,\n    \"url\": url.startsWith(\"{{\") ? url : url ? surl + url : \"\",\n    \"style\": {\n      layout_flexGrow: size || 1,\n      layout_flexBasisPercent: -1,\n      layout_wrapBefore: wrap ? wrap : false\n     }\n  });\n\nfor (x in obj) {\npush(x, obj[x].url, obj[x].fg, obj[x].wb);\n}\n\n//版本号\npush(\"版本号:\"+banben+\"　点我刷新地址\", `{{if(page==1) {cache.put('8xbl1', source.getVariable()); source.setVariable(''); eval(String(source.loginUrl)); if (java.get(\"bj1\") ==1) {r='书源地址更新成功&#10;请返回发现页，然后长按本书源的名称&#10;在弹出的菜单中点击刷新按钮\" zuozhe=\"成功'} else if (java.get(\"bj1\") ==2) {r='获取地址失败&#10;可能原因:①被拉黑(稍后再试，或主动换ip)②发布页有变动(更新书源版本)\" zuozhe=\"失败'} else {r='该地址已经是最新了呢&#10;如果书源依旧异常&#10;可以反馈给我\" zuozhe=\"重复'} java.put('bj1', 0); java.put('bj2', r);} 'http://127.0.0.1/'+page}}`, 1, true);\npush(\"测速/更新\",`{{eval(String(source.loginUrl));gengxin(); Packages.java.lang.Thread.sleep(100); ceshi(); 'http://127.0.0.1/'}}`, 1);\n\nJSON.stringify(sort);",
  "header": "@js:\n(()=>{\n    let ck = source.getLoginHeader() || '';   \n    let headers = {\n    \t'User-Agent': ua,\n    \t'x-requested-with': x_r_w,\n    \t'sec-ch-ua': s_c_u,\n    \t'sec-ch-ua-platform': s_c_u_p,\n    \t'cookie': ck\n    \t };\n    \t return JSON.stringify(headers);\n})();",
  "jsLib": "ua = 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36 Edg/131.0.2903.77';\nx_r_w = 'com.microsoft.emmx';\ns_c_u_p = 'Android';\ns_c_u = `\"Not(A:Brand\";v=\"99\", \"Android WebView\";v=\"133\", \"Chromium\";v=\"133\"`;\n\nfunction hexToInt(e, t) {\n        var r = e.substr(t, 2);\n        return parseInt(r, 16);\n    }\nfunction decodeEmail(n, c) {\n    var o = \"\", a = hexToInt(n, c), i = c + 2;\n    for (i; i < n.length; i += 2) {\n        var l = hexToInt(n, i) ^ a;\n        o += String.fromCharCode(l);\n    }\n        o = decodeURIComponent(escape(o));\n        return o\n}\n\n\nfunction ftsm(){\n\tconst {java, source} = this;\n\tlet nm = source.get('8xftn');\n\tif(nm==''||nm<0) {nm=5;}\nif(nm>0) {\n\tnm--;\n\tsource.put('8xftn',nm);\n\tlet ss = String(source.bookSourceComment).match(/\\n┍[^┘]+┘/)[0];\n\tjava.longToast(ss+'\\n该弹窗剩余次数：'+nm);\n\tPackages.java.lang.Thread.sleep(1500);\n\tjava.longToast(ss+'\\n该弹窗剩余次数：'+nm);}\n}\n\nfunction gengxin(){\n\tconst {java, source} = this;\n\tlet url0='https://gitee.com/lyc486/yuedu2/commits/main/书源/八叉/8x.json?browser_history=0&page=1&per=3';\n\tlet rr0=java.get(url0,{'User-Agent': 'Mozilla/5.0 (Linux; Android 14)','X-Requested-With': 'XMLHttpRequest'}).body();\n\tlet \tgxlrr = com.jayway.jsonpath.JsonPath.read(rr0, '$.list[0:3].title');\n\tlet [gxlr, gxlr2, gxlr3] = gxlrr;\n\tlet banben =   String(source.exploreUrl).match(/let banben = '([\\d\\.]+)'/)[1];\n\tgxlr=String(gxlr).split(/^([^\\-]+)-/);\n\tgxlr[0]=='' ? '' : gxlr=['','0',gxlr[0]];\n\tlet gxts;\n\tif (gxlr[1]>banben){gxts=['更新','0,140,186'];}\n\telse {gxts= ['导入','76,175,80'];};\n\tlet htm = `data:text/html;charset=utf-8,<html>\n<head>\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n<style>\ntable {\n\ttext-align: center;\n\tmargin: 0 auto;\n\t}\n.ann {\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\theight: 50vh;\n\t}\nbutton {\n\tbackground-color: rgb(${gxts[1]});\n\tcolor: white;\n\tborder: none;\n\tborder-radius: 4px;\n\theight: 6vh;\n\twidth: 30vw;\n\toverflow: hidden;\n\t}\nbutton span {\n  cursor: pointer;\n  display: inline-block;\n  position: relative;\n  transition: 0.4s;\n}\nbutton span:after {\n  content: '>';\n  position: absolute;\n  opacity: 0;\n  top: 0;\n  right: 30px;\n  transition: 0.2s;\n}\nbutton:active span {\n  padding-right: 20px;\n}\nbutton:active span:after {\n  opacity: 1;\n  right: -40px;\n}\n</style>\n</head>\n<body>\n<table border=\"1\" cellspacing=\"0\">\n<th colspan=\"2\">最新日志：${gxlr[2]}</th>\n<tr>\n<td>仓库版本：${gxlr[1]}</td>\n<td>本地版本：${banben}</td>\n</tr>\n<tr>\n<td colspan=\"2\" style=\"text-align: left;\">往期日志：${gxlr2}<br>　　　　　${gxlr3}</td>\n</tr>\n</table>\n<div class=\"ann\">\n<a href=\"legado://import/Source?src=https://gitee.com/lyc486/yuedu2/raw/main/书源/八叉/8x.json\">\n<button><span>${gxts[0]}</span></button>\n</a>\n</div>\n</body>\n</html>`;\nif(typeof this.chapter=='undefined'||gxts[0]=='更新') java.startBrowser(htm,'更新');\r\n}",
  "lastUpdateTime": 1738515415041,
  "loginCheckJs": "//java.toast('登录检查:'+result);\nlet code = result.code();\nif (code == 403) {\n\tjava.toast('\\n访问被拒绝');\n\t}\nresult",
  "loginUi": "[\n    {\n        name: \"账号\",\n        type: \"text\"\n    },\n    {\n        name: \"密码\",\n        type: \"password\"\n    },\n    {\n        name: \"💍注册\",\n        type: \"button\",\n        action: \"web()\",\n        \"style\": {\n            \"layout_flexGrow\": 0,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        name: \"🔺登　录🔺\",\n        type: \"button\",\n        action: \"Login()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        name: \"♤登出\",\n        type: \"button\",\n        action: \"re()\",\n        \"style\": {\n            \"layout_flexGrow\": 0,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n    \tname: \"💬说明\",\n    \ttype: \"button\",\n    \taction: \"sm()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1,\n            \"layout_wrapBefore\": true\n        }\n    \t},\n    \t{\n        name: \"🧾延迟测试\",\n        type: \"button\",\n        action: \"ceshi()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    \t{\n        name: \"⏭️启用下载\",\n        type: \"button\",\n        action: \"downl()\",\n        \"style\": {\n            \"layout_flexGrow\": 0,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    \t{\n        name: \"🌐打开本书↓\",\n        type: \"button\",\n        action: \"webb()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1,\n            \"layout_wrapBefore\": true\n        }\n    },\n    \t{\n        name: \"❌屏蔽\",\n        type: \"button\",\n        action: \"hmd()\",\n        \"style\": {\n            \"layout_flexGrow\": 0,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    \t{\n        name: \"🧹清空\",\n        type: \"button\",\n        action: \"hmdre()\",\n        \"style\": {\n            \"layout_flexGrow\": 0,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        name: \"书名\",\n        type: \"text\"\n    },\n    \t{\n        name: \"🆕版本更新\",\n        type: \"button\",\n        action: \"gengxin()\",\n        \"style\": {\n            \"layout_flexGrow\": 0,\n            \"layout_flexBasisPercent\": -1\n        }\n    }\n]",
  "loginUrl": "nn = String(source.getVariable()).replace(/\\/$/,'');\nif (!nn) {\nlet rr=java.connect('https://www.8xsk.org/');\nlet cd=rr.code();\nlet ur=(rr.body().match(/电脑主站[^\"]+\\\"([^\"]+)\\\"/)||['',''])[1];\nlet x = cache.get('8xbl1');\n\nif (cd != 200||ur == '') {\n\tjava.longToast(\"书源地址获取失败💔\"+ur);\n\tsource.setVariable(x);\n\tjava.put(\"bj1\", 2);\n\t}\nelse {\n\tif (ur != x) {\n\t\t\tsource.setVariable(ur);\n\t\t\t//java.log(\"登录URL：源地址获取成功\");\n\t\t\tcache.put('8xbl1',ur);\n\t\t\tjava.put(\"bj1\", 1);}\n\t\telse {\n\t\t\tsource.setVariable(x);\n\t\t\tjava.put(\"bj1\", 0);}\n\t}\n}\n\nfunction login(){}\r\nfunction Login(){\n    let Info = source.getLoginInfoMap()||{};\r\n    let url = nn+'/login.php';\r\n    let un = Info['账号'] = result['账号'];\r\n    let pw = Info['密码'] = result['密码'];\r\n    let time = new Date().getTime();\n    \n    var body = `username=${un}&password=${pw}&usecookie=1&submit=&act=login`;\n    \n    weiba = `?do=submit&jumpurl=${nn}`;\n    \r\n    let headers = {\r\n        'referer': nn,\n        \t'user-agent': ua,\n        \t'x-requested-with': x_r_w,\n        \t'sec-ch-ua-platform': s_c_u_p\r\n    };\n    if (un!=''&&pw!='') {\n    cookie.removeCookie(nn);\n    let cookie1 = java.post(url+ weiba,body,headers).cookies();\n    let ck = cookie.mapToCookie(cookie1);\n    //处理cookie格式\r\n    source.putLoginHeader(ck);\n    cookie.removeCookie(nn);\n    let i = String(ck).includes(\"jieqiUserInfo\");\r\n    if (i) {source.putLoginInfo(JSON.stringify(Info));java.toast(\"登录成功，VIP模式💎\");}\r\n    else java.toast(\"登录失败，访客模式🔒\");\n    } else {java.toast(\"💔账号和密码不能为空\");}\n\r\n}\r\n\r\nfunction web(){\r\n    let url = nn.replace('www.','') + '/register.php';\r\n    java.startBrowser(url, '八叉注册');\r\n}\n\nfunction ceshi(){\n  java.toast('\\n\\n正在测试延迟...\\n');\n  const startTime=new Date().getTime();\n\tjava.head(nn,{\t'user-agent': ua})\n\tconst endTime=new Date().getTime();\n\tlet speed = (endTime - startTime) / 1000;\n\tif(speed > 1){\n\t\tspeed = speed.toFixed(2);\n\t\t}else{\n\t\t\tspeed = speed.toFixed(3);\n\t\t\t}\n\t\t\tjava.longToast('\\n\\n延迟：'+speed+'秒\\n');\r\n}\n\n\r\nfunction re(){\r\n    cookie.removeCookie(nn);\n    source.removeLoginHeader();\n    //清除登录头\n    java.toast(\"回到访客模式🔒\");\r\n}\n\r\nfunction sm(){\nlet banben =   String(source.exploreUrl).match(/let banben = '([\\d\\.]+)'/)[1];\nlet ss = String(source.bookSourceComment).match(/^[^┘]+┘/);\nlet cki = String(source.getLoginHeader()).includes(\"jieqiUserInfo\");\n    let ms= \"访客模式🔒\";\n    if (cki != '') {\r\n        ms = \"VIP模式💎\";\r\n    }\r\nlet tt = `\n网址：${nn}　　 \n模式：${ms}　　　　　　   \n版本：${banben}　　　　　　　　　　\n\n${ss}`;\n    java.longToast(tt);\r\n}\n\nfunction webb(){\n\tlet id = cache.getFromMemory('8xid');\n  if (id) {\n  \tid=Object.keys(id)[0];\n  \tlet nnm=nn.replace('www.','');\n  \tlet ck=source.getLoginHeader()||'';\n   cookie.replaceCookie(nnm,ck);\n   java.startBrowser(`${nnm}/book/${id}.html`,'八叉');\n   } else {java.toast('\\n请在书籍界面点击或刷新书籍');}\n}\n\nfunction hmd(){\n\tlet id = cache.getFromMemory('8xid');\n\tif (id) {\n\tlet hmd = cache.getFile('8xhmd')||'{}';\n\thmd = JSON.parse(hmd);\n\tlet idd = Object.keys(id)[0];\n\tif (idd in hmd) {\n\t\tdelete hmd[idd];\n\t\tcache.putFile('8xhmd',JSON.stringify(hmd),0);\n\t\tjava.longToast('\\n已将书籍：'+Object.values(id)[0]+'\\n移除黑名单');\n\t\t}\telse {\n\thmd = Object.assign({},hmd,id);\n\tcache.putFile('8xhmd',JSON.stringify(hmd),0);\n\tjava.longToast('\\n已将书籍：'+Object.values(id)[0]+'\\n加入黑名单');}\n\t\n\t} else {java.toast('\\n请在书籍界面点击或刷新书籍');}\n\t\n}\n\nfunction hmdre(){\n\tlet hmd=cache.getFile('8xhmd')||'{}';\n\thmd=JSON.parse(hmd);\n\tlet ss=Object.entries(hmd);\n\nlet svg=`<svg width=\"990\" height=\"300\" xmlns=\"http://www.w3.org/2000/svg\">\n<style>\ntext {\n\twhite-space: pre;\n\tword-wrap: break-word;}\n</style>\n<text fill=\"#a2a9b6\" text-anchor=\"middle\" dominant-baseline=\"middle\" stroke=\"#000000\" stroke-width=\"1\" font-weight=\"bold\">\n<tspan x=\"50%\" dy=\"30%\" font-size=\"100\">\n是否清空黑名单<tspan font-size=\"30\">（${ss.length}）</tspan>\n</tspan>\n<tspan x=\"42%\" dy=\"25%\" font-size=\"60\">输入“确认”进行清空</tspan>\n<tspan x=\"50%\" dy=\"20%\" font-size=\"50\">输入“名单”打印一份名单到日志</tspan>\n<tspan x=\"50%\" dy=\"20%\" font-size=\"50\">输入书籍ID单独移出黑名单<tspan font-size=\"30\">(名单查看)</tspan></tspan>\n</text>\n</svg>`;\nsvg=java.base64Encode(svg);\n\ntry {\n//拦截验证码报错\nlet ysr=java.getVerificationCode('data:image/svg+xml;base64,'+svg);\nPackages.java.lang.Thread.sleep(100);\nif (ysr=='确认') {cache.delete('8xhmd');java.toast('\\n已清空');}\nelse if (ysr=='名单') {java.log('\\n💔8x黑名单：\\n'+ss.join('\\n'));}\nelse if (/\\d{3,}/.test(ysr)) {\n\tif (ysr in hmd) {\n\tjava.toast('\\n已将书籍：'+hmd[ysr]+'\\n移除黑名单');\n\tdelete hmd[ysr];\n\tcache.putFile('8xhmd',JSON.stringify(hmd),0);\n\t} \telse {java.toast('移出失败');}\n\t}\n} catch(err) {}\n\n}\n\nfunction downl() {\nlet dn = source.get('8xdn');\nif(dn!=1) {source.put('8xdn',1);java.toast('已支持下载');}\nelse {source.put('8xdn',0);java.toast('已优化加载');}\n\t}",
  "respondTime": 180000,
  "ruleBookInfo": {
    "author": "",
    "canReName": "",
    "coverUrl": "class.divbox cf@img@src",
    "init": "<js>\n//搜索跳详情重定向(含已放书架的http)处理，新版本有优化，但data依旧需要保持\nlet i = String(book.bookUrl).includes('https:/');\nif (i) {\n\tbook.bookUrl = `data:;base64,${java.base64Encode(baseUrl)},{'type':''}`;\n\t}\n\n//告诉目录是由详情来的\njava.put('sx1',1);\n\nnn = String(source.getVariable()).replace(/\\/$/,'');\nif (nn=='') { {{source.loginUrl}} }\n\n//发书评功能\nlet bkbl = book.getVariable(\"custom\");\n//解书籍地址\nlet ml = String(book.bookUrl).replace(/.+,(.+),.+/,'$1');\nlet mlj = java.base64Decode(ml);\nlet bkid = (mlj.match(/book\\/(\\d+)/)||['',''])[1];\n//↑获取书id\njava.put('bkid',bkid);\n//java.log('详情地址：'+mlj);\nif (bkbl=='🔒'||bkbl=='') {\n//带🔒或书籍变量为空会经过这里(跳过)\n\t}\nelse if (bkbl=='目录') {\n\t//清空最新章储存强制刷新目录\n\tjava.put('8xzx','');\n\t//清空输入的书籍变量\n\tbook.putCustomVariable('');}\nelse {\nlet pfurl = nn+'/modules/article/rating.php';\nlet plurl = nn+'/modules/article/reviews.php';\nlet ck = source.getLoginHeader();\nlet cki = ck.match(/UserToken%3D([^%]+)/)||['',''];\ntk = cki[1];\n//↑获取链接和tk\n\nif (bkid != '' && tk != '') {\nlet tm = new Date().getTime();\nlet bkfs = (bkbl.match(/^(\\d|10)分$/) || ['','0'])[1];\nlet pfbody = `score=${bkfs}&id=${bkid}&ajax_request=${tm}`;\nlet plbody = `ptitle=&act=newpost&jieqi_token=${tk}&Submit=&pcontent=${bkbl}&aid=${bkid}&ajax_request=${tm}`;\n\nlet headers = {\r\n        'User-Agent': ua,\n        'x-requested-with': x_r_w,\n        'sec-ch-ua-platform': s_c_u,\r\n        'referer': mlj,\n        'cookie': ck\r\n    };\nif (bkfs != 0) {url=pfurl;body=pfbody;}\nelse {url=plurl;body=plbody;}\n//清空输入的书籍变量\nbook.putCustomVariable('');\nlet by = java.post(url,body,headers).body();\njava.longToast(\"\\n\"+java.htmlFormat(by));\n\t}\n}\n\n//随机延时0-1秒\nlet tim = Math.floor(Math.random()*1001);\n//java.log('延时'+tim);\nPackages.java.lang.Thread.sleep(tim);\n\n//先发评论再访问刷新\nif (!i) {\n\tlet tt = java.hexDecodeToString(result);\n\tconst startTime=new Date().getTime();\n\tresult = java.ajax(tt);\n\tconst endTime=new Date().getTime();\n\tlet speed = (endTime - startTime)/1000;\n\tif (speed>9) {java.toast('\\n详情页访问延迟：'+speed.toFixed()+'秒');}\n\tjava.setContent(result);\n\t}\n\n//内容判断\nlet r = java.getString('@@meta[name=\"keywords\"]@content');\nlet name=String(r).replace(/\\, .+/,'');\nlet author=String(r).replace(/.+\\, /,'');\n\nif (name) {\n\tbook.name=String(book.name)||name;\n\tbook.author=String(book.author)||author;\n//放入书名\nlet Info=source.getLoginInfoMap()||{};\nInfo['书名'] = book.name;\nsource.putLoginInfo(JSON.stringify(Info));\n//放入ID和书名(黑名单用)\ncache.putMemory('8xid',{[bkid]: book.name});\n\tif (book.name!=name) {\n\t\t//书名不同，可能源地址换新了\n\t\t\tcache.put('8xbl1', source.getVariable() );\n\t\t\tsource.setVariable('');\n\t\t\t//清空源地址，会自动更新\n\t\t\tjava.toast(\"详情页获取的书名不同\");java.log(\"书名：\"+author);\n\t\t\t}\n\telse if (book.author!=author) {java.log(\"获取的作者不同，作者：\"+author);} //仅输出日志\n\t\n\t//else {java.log(`《${book.name}》${book.author}`);}//仅提示\n\t//书名和作者正常由此过\n\t}\nelse {\n\t//书名加载失败\n\tcache.put('8xbl1', source.getVariable() );\n\tsource.setVariable('');\n\t{{source.loginUrl}}\n\t//解书籍url为http，并拼接新源地址(无法解决书籍id不存在的情况)\n\tlet ml = String(book.bookUrl).replace(/.+,(.+),.+/,'$1');\n\tlet mlj = java.base64Decode(ml);\n\tlet rr = String(mlj).replace(/https\\:\\/{2}[A-z\\d\\.]+/, nn);\n\tbook.bookUrl=`data:;base64,${java.base64Encode(rr)},{'type':''}`\n\t//java.refreshBook();//可能会重复循环\n\t//java.log('详情页源码：'+result);\n\tjava.toast(\"详情页加载失败，已自动更新地址\");\n \n}\n\tresult\n</js>",
    "intro": "{{\n//书名过长时在简介显示\nlet length = 0;\nlet fuhao = ',.?!:;()[]\"';\n\nfor (char of String(book.name)) {\n\tif (fuhao.includes(char) ) length += 0.5;\n\telse length += 1;\n\t}\n//大于18个全角字符\nif (length > 18) '《'+book.name+'》'\nelse '&#10;'\n}}\n{{\nlet zx = java.getString('class.divbox@h3@a@text');\nlet temp=java.getStringList('class.tabcontent@class.tabvalue.1@td[0:3,9,10]@text');\nrr=Object.values(temp);\n//处理rr\n[rr[0], rr[2]] = [rr[2], rr[0]];\nrr[0] = '最新：' + String(zx).replace(/^正文|^\\s+/,'') + String(rr[0]).replace('最后更新：',' ').replaceAll('-','/') + String(rr[1]).replace(/连载状态：(.+)/,' ($1)');\ndelete rr[1];\nrr[2] = String(rr[2]).replace(/作品分类：\\s*/,'分类：') + String(rr[3]).replace(/作品性质：(.+)/,' ($1)');\ndelete rr[3];\nrr[4] = String(rr[4]).replace(/总点击数：\\s*/,'点击：') + String(rr[5]).replace(/本月点击：(.+)/,'　$1 (月)');\ndelete rr[5];\n//评分\nlet pf=java.getString('.ratediv@text');\nlet r0 = rr.join('\\n') + '\\n' + String(pf).replace(/评分：\\s*/,'评分：');\n//简介\nlet r1=java.getString('.tabcontent .tabvalue:eq(0) div@html');\nif (r1==\"\") {r1='';}\nelse {\n r1 = '\\n简介：\\n' + String(r1).replace(/[\\u3000\\u2003]{2}/g,'\\n').replace('「','“').replace('」','”').replace(/\\>\\s*内容简介/,'')\n\t}\n//评论\nlet r2=String(java.getString('#content>.c_row@html'));\nlet xi = book.getVariable(\"custom\")==\"🔒\";\nif (r2==''||xi) {r2='';}\nelse {\n\tr2 = r2.replace(/<div class=\"c_subject\"[\\S\\s]+?div>|<span class=\"fr\"[\\S\\s]+?span>|回复：.+/g,'').replace(/<p[> ].+<\\/p>/g,'﹍');\n\t//java.htmlFormat(r);\n\t}\n\tr0 + r1 + r2\n}}",
    "kind": "b:contains(标签：)~a@text\n<js>\nString(result).slice(1, -1).replace(/[\\#\\,]/g,'').split(' ');\n</js>",
    "lastChapter": "class.divbox@h3@a@text\n<js>\nlet zx = java.get('8xzx');\nif (zx==result) java.put('ww',1);\nelse {java.put('8xzx',result);java.put('ww',0);}\nresult\n</js>",
    "name": "",
    "tocUrl": "<js>\n//清除用户自定义简介\n//book.upCustomIntro();\n//book.delete();\n//解书籍url为http\nlet ml = String(book.bookUrl).replace(/.+,(.+),.+/,'$1');\nlet mlj = java.base64Decode(ml);\nif (mlj.includes('search.php') ) {java.toast('书籍地址异常');}\n//转化目录url\nlet mll = mlj.replace('/book/', '/read/');\n`data:;base64,${java.base64Encode(mll)},{'type':''}`;\n</js>",
    "wordCount": ".tabcontent .tabvalue.1@html##全文字数：(\\d+)##$1###"
  },
  "ruleContent": {
    "content": "<js>\nlet bin = book.durChapterIndex;\nlet cin = chapter.index;\nlet inn = cin - bin;\nlet dn = source.get('8xdn');\nlet sleep = Packages.java.lang.Thread.sleep;\n//java.log(chapter.title+'inn：'+inn);\nif ((inn==-4||inn==4)&&dn!=1) {java.longToast('\\n使用下载需要在书源登录界面开启功能\\n建议预下载设定不要大于3');}\n\nnn = String(source.getVariable()).replace(/\\/$/,'');\nif (nn=='') { {{source.loginUrl}} }\n\nlet tim = Math.floor(Math.random()*501);\nlet ii = 1;\n//*手动限制并发，至少大于1.5秒才防拉黑，下载时靠并发率限制(有个0-50秒随机)\n\nswitch(inn) {\n\tcase 0: break;\n\tcase 1: sleep(1500+tim); break;\n\tcase 2: sleep(4500+tim); break;\n\tcase 3: sleep(7500+tim); break;\n\tcase -1: sleep(3000+tim); break;\n\tcase -2: dn==1 ? sleep(6000+tim) : ii=0;break;\n\tcase -3: dn==1 ? sleep(9000+tim) : ii=0;break;\n\tdefault: dn==1 ? sleep(tim*100) : ii=0;break;\n}\n\n//延时结束\n//java.log(chapter.title+'inn：'+inn+'延时结束');\nlet bkid = java.get('bkid');\n//放入书名和id\ncache.putMemory('8xid',{[bkid]: book.name});\nlet Info=source.getLoginInfoMap()||{};\nInfo['书名'] = book.name;\nsource.putLoginInfo(JSON.stringify(Info));\n\nlet tt = java.hexDecodeToString(result);\n//java.log('正文地址：'+tt);\nlet ml = String(book.tocUrl).replace(/.+,(.+),.+/,'$1');\nlet mlj = java.base64Decode(ml);\nlet ck0 = source.getLoginHeader();\nlet headers0 = {\r\n        'user-agent': ua,\n        'x-requested-with': x_r_w,\n        'sec-ch-ua': s_c_u,\n        'sec-ch-ua-platform': s_c_u_p,\r\n        'referer': mlj,\n        'cookie': ck0\r\n    };\n\nlet getr;\nif (ii) {\nconst startTime=new Date().getTime();\n//↓第一次访问正文\ngetr = java.get(tt,headers0);\n//java.log(chapter.title+'inn：'+inn+'访问结束');\nconst endTime=new Date().getTime();\n//判断访问情况，错误时把响应内容清除\nif (getr.statusCode() == 200) {\n\tresult = getr.body();\n\tlet speed = (endTime - startTime)/1000;\n\tif (speed>9) java.toast('\\n正文页访问延迟：'+speed.toFixed()+'秒');\n\t} else {java.toast('\\n正文链接访问出错，inn='+inn);result='';}\n//复原手机版链接，干掉字数统计\nchapter.url = tt.replace('www.','');\n// if ii 结束\n\t} else {result='';}\n//利用，下下章为空，会自动刷新特性\n\nlet rr = java.getString('class.mt mb@a@text||class.tc mb@a@text',result);\n\n//内容识别\nif (rr.includes(\"登录\") ) {\n\tjava.toast(\"💎请重新登录书源账号\");\n\tresult='';}\nelse if (rr.includes(\"充值\") ) {\nlet url = nn+'/modules/obook/buychapter.php';\nlet ck = source.getLoginHeader();\nlet tk = (ck.match(/UserToken%3D([^%]+)/)||['',''])[1];\nlet cid = tt.match(/cid\\=(\\d+)/)[1];\nlet body = `buytype=1&act=buy&jieqi_token=${tk}&cid=${cid}&submit=`;\nlet headers = {\r\n        'user-agent': ua,\n        'x-requested-with': x_r_w,\n        'sec-ch-ua': s_c_u,\n        'sec-ch-ua-platform': s_c_u_p,\r\n        'referer': tt,\n        'cookie': ck\r\n    };\n    \nlet vip = cache.getFromMemory('8xvip'+bkid);\nif (tk && nn&&vip!=1) {\n\t//标识本书准备请求VIP，防延时期间其它章节请求\n\tcache.putMemory('8xvip'+bkid,1);\n\tsleep(1000-tim);\n\tlet pt = java.post(url,body,headers);\n\tlet lc = pt.header(\"location\");\n\tjava.toast(\"🔓已购买\");\n\t//重新解析正文\n\tresult = java.ajax(lc);\n\tresult = java.getString('#content,#acontent@html',result);\n\t} else {java.longToast(\"💔VIP内容获取失败\");\n\tresult='';}\n\n}\nelse {\n//java.log('inn：'+inn+'完成');\n//无VIP登录，正常直接加载\n\nresult = java.getString('#content,#acontent@html',result);\n}\n//每次加载第9，39，139章进行一次无感检查更新(天才的想法)\nif ([9, 39, 139].includes(cin)) gengxin();\n//java.log(chapter.title+'inn：'+inn+'代码结束');\nresult\n</js>",
    "imageStyle": "",
    "nextContentUrl": "",
    "payAction": "",
    "replaceRegex": "##八叉书库|八叉~书库|八叉书[,~]库|(?:833330|8xsk)\\.(?:xyz|org)|(?:833330|8xsk|八叉)([^\\.])(?:xyz|yxz|org|书库)|八~叉|书~库##$1",
    "sourceRegex": "",
    "title": ""
  },
  "ruleExplore": {
    "author": "td.2@text||span:contains(作者：)+span@text||a486@zuozhe\n<js>\nif (result == '[email protected]') {\n\tlet hex = java.getString('.__cf_email__.0@data-cfemail');\n\tresult = decodeEmail(String(hex),0);\n\t}\n\tresult\n</js>",
    "bookList": "<js>\nif (baseUrl.startsWith('http://127.0') ) {\n\tif(baseUrl.endsWith('1')) {\n\t\tlet d=new Date();\n\t\tr=`<a486 jianjie=\"${java.get('bj2')}\" time=\"${java.timeFormat(d)}\">反馈结果</a486>`;\n\t\tresult=[r]\n\t\t}\n\t\telse {result = [];}\n}\n\nelse if (baseUrl.includes('search.php?') ) {\nlet r1 = java.getString('#content .blockcontent@text');\nif (r1.includes(\"错误原因\")) {java.longToast(r1);result = [];}\nelse {result = java.getElement('#jieqi_page_contents>div');}\n\t}\nelse if (baseUrl.includes('/book/') ){\njava.toast('暂不支持重定向结果');\nresult=[];\n\t}\nelse {\nresult = java.getElements('@@#jieqi_page_contents>tr||#content div[class=\"c_row cf\"]');\n}\nresult\n</js>",
    "bookUrl": "<js>\nif (baseUrl.includes('search.php?') ) {\t\n\trs = java.getString('class.c_subject@a.0@href');\n\t} else {\n\trs = java.getString('td.0@a.-1@href||class.c_subject@a.1@href');\n\t}\nnn = String(source.getVariable()).replace(/\\/$/,'');\nrr = String(rs).replace(/https\\:\\/{2}[A-z\\d\\.]+/, nn);\n\n`data:;base64,${java.base64Encode(rr)},{'type':''}`\n</js>",
    "coverUrl": "<js>\nif (/articlelist|sort/.test(baseUrl)) {\n\timg = java.getString('img@src');\n\t}\nelse if (baseUrl.includes('search.php?') ) {\n\timg = java.getString(String(source.ruleSearch.coverUrl));\n\t}\nelse{\n\tid = java.getString('td.0@a.-1@href').match(/\\d+(?=\\.html)/);\n  if (id < 1000) n = 0;\n  else n = String(id).slice(0,-3);\nimg = `/files/article/image/${n}/${id}/${id}s.jpg`;\n}\nimg\n</js>",
    "intro": "td.3@text||class.c_description@text||a486@jianjie\n<js>\nif (baseUrl.includes(\"top/words\")) {'⠀\\n字数：'+(result/10000).toFixed(2)+'万'}\nelse if (baseUrl.includes(\"top/goodnum\")) {'⠀\\n收藏数：'+result}\n//新书榜\nelse if (baseUrl.includes(\"top/newhot\")) {\n\tresult = result>9999 ? \t(result/10000).toFixed(2)+'万' : result;\n\t'⠀\\n点击数：'+result}\nelse if (baseUrl.includes(\"top/signtime\")) {\n  let t = parseInt(result)*1000;\n  let time = java.timeFormatUTC(t,\"⠀\\n签约时间：yy/MM/dd HH:mm:ss\",8*60*60*1000);\n  time}\nelse if (baseUrl.includes(\"top/lastupdate\")) {'⠀\\n字数：'+(result/10000).toFixed(2)+'万'}\nelse if (baseUrl.includes(\"top/postdate\")) {'⠀\\n入库时间：'+result}\nelse if (baseUrl.includes(\"top/allvisit\")) {\n\tresult = result>999 ? \t(result/10000).toFixed(2)+'万' : result;\n\t'⠀\\n总点击：'+result}\nelse if (baseUrl.includes(\"top/monthvisit\")) {\n\tresult = result>999 ? \t(result/10000).toFixed(2)+'万' : result;\n\t'⠀\\n月点击：'+result}\nelse if (baseUrl.includes(\"top/weekvisit\")) {\n\tresult = result>9999 ? \t(result/10000).toFixed(2)+'万' : result;\n\t'⠀\\n周点击：'+result}\nelse if (baseUrl.includes(\"top/allvote\")) {'⠀\\n总推荐：'+result}\nelse if (baseUrl.includes(\"top/monthvote\")) {'⠀\\n月推荐：'+result}\nelse if (baseUrl.includes(\"top/weekvote\")) {'⠀\\n周推荐：'+result}\nelse if (/articlelist|sort|search\\.php/.test(baseUrl)) {\n//含简介(搜索会经此)\nresult.replace('「','“').replace('」','”').replace(/\\s+/g,' ')}\nelse if (baseUrl.startsWith('http://127.0') ) {'⠀\\n'+result}\nelse {''}\n</js>",
    "kind": "<js>\nif (baseUrl.includes('search.php?') ) {java.getStringList(String(source.ruleSearch.kind));}\nelse {java.getStringList('td[4,5]@text||span:contains(更新：)+span@text||a486@time');}\n</js>",
    "lastChapter": "<js>\nif (baseUrl.includes('search.php?') ) {\tjava.getString(String(source.ruleSearch.lastChapter));\n\t}\n\telse {java.getString('td.1@a.-1@text||class.c_subject@a.-1@text');}\n</js>",
    "name": "<js>\nif (baseUrl.includes('search.php?') ) {\nresult=String(java.getString('.c_subject@text')).replace(/\\\"/g,'');\n//获取id目的\nrs = java.getString('class.c_subject@a.0@href');\n\t}\n\telse {\n\t\tresult =  java.getString('td.0@a.-1@text||class.c_subject@a.1@text||a486@text');\n\t\t//获取id目的\n\t\trs = java.getString('td.0@a.-1@href||class.c_subject@a.1@href');}\n\nlet hmd=cache.getFile('8xhmd')||'{}';\nhmd=JSON.parse(hmd);\n//获取id，黑名单时书名为空\nlet id = (rs.match(/book\\/(\\d+)/)||['','lyc'])[1];\nif (id in hmd) {result='';}\nresult\n</js>",
    "wordCount": "<js>\nif (/articlelist|sort/.test(baseUrl)) {\n  java.getString('span:contains(字数：)+span@text')\n}\nelse if (baseUrl.includes('search.php?') ) {\tjava.getString(String(source.ruleSearch.wordCount));\n\t}\n</js>"
  },
  "ruleSearch": {
    "author": "span:contains(作者：)+span@text",
    "bookList": "<js>\njava.setContent(cache.get('8xss1') );\ncache.delete('8xss1');\nlet r1 = java.getString('#content .blockcontent@text');\nif (r1.includes(\"错误原因\")) {java.longToast(r1);result=[];}\nelse {\n\tresult = java.getElement('#jieqi_page_contents>div');\n}\nresult\n</js>",
    "bookUrl": "class.c_subject@a.0@href\n<js>\n`data:;base64,${java.base64Encode(result)},{'type':''}`\n</js>",
    "checkKeyWord": "作者：棺材",
    "coverUrl": ".fl img@src",
    "intro": ".c_description@text\n<js>\nresult.replace('「','“').replace('」','”').replace(/\\s/g,' ')\n</js>",
    "kind": "span:contains(更新：)+span@text&&span:contains(关键字：)+span@text\n<js>\nString(result).replace(/[\\[\\]\\#\\,]/g,'').split(' ');\n</js>",
    "lastChapter": "span:contains(最新章节：)+span@text",
    "name": ".c_subject@text\n<js>\nlet hmd=cache.getFile('8xhmd')||'{}';\nhmd=JSON.parse(hmd);\n//获取id，黑名单时书名为空\nlet id = java.getString('class.c_subject@a.0@href');\nid = id.match(/book\\/(\\d+)/)[1];\nif (id in hmd) {result='';}\nresult\n</js>",
    "wordCount": "span:contains(字数：)+span@text"
  },
  "ruleToc": {
    "chapterList": "<js>\nlet ww = java.get('ww'),\nlyc = java.get('lyc'),\nsx1 = java.get('sx1'); //刷新标识\nif (ww!=1 || lyc=='' || sx1!=1) {\nlet tim = Math.floor(Math.random()*1501);\nlet tt = java.hexDecodeToString(result);\n//java.log('目录地址：'+tt);\nPackages.java.lang.Thread.sleep(tim);\nconst startTime=new Date().getTime();\nresult = java.ajax(tt);\nconst endTime=new Date().getTime();\nlet speed = (endTime - startTime)/1000;\nif (speed>9) {java.toast('\\n目录页访问延迟：'+speed.toFixed()+'秒');}\n//缩减储存\nresult=java.getString('.index@all',result);\njava.put('lyc',result);\n} else {result=lyc;}\njava.put('sx1',0); //还原详情到目录标识\njava.setContent(result);\nresult=java.getElements('.index dd,dt');\n</js>",
    "chapterName": "text##八叉书库|833330\\.xyz|八叉书[。·]库|8xsk?[。·]org|八叉~书库|八~叉书~库",
    "chapterUrl": "a@href\n<js>\n`data:;base64,${java.base64Encode(result)},{'type':''}`;\n</js>",
    "formatJs": "",
    "isPay": "",
    "isVip": "",
    "isVolume": "dt@text",
    "preUpdateJs": "",
    "updateTime": "{{@@dd@a@title##\\d{1,2}\\:\\d{1,2}更新，共(\\d+字).*## $1}}\n{{@@dd@em@text##.+##💎}}"
  },
  "searchUrl": "<js>\nftsm();\neval(String(source.loginUrl));\nnn = String(source.getVariable()).replace(/\\/$/,'');\nlet url = `${nn}/modules/article/search.php`;\ntry {\n\tif (key.startsWith('书名：') ) {\n\t\turl += `?searchkey=${key.substr(3)}&searchtype=articlename&page=${page}`\n\t\t\tss = java.get(url,{\t'user-agent': ua});\n\t\t}\n\t\t\n\t\telse if (key.startsWith('作者：') ) {\n\t\turl += `?searchkey=${key.substr(3)}&searchtype=author&page=${page}`\n\t\t\tss = java.get(url,{\t'user-agent': ua});\n\t\t}\n\t\t\n\t\telse if (key.startsWith('标签：') ) {\n\t\turl += `?searchkey=${key.substr(3)}&searchtype=keywords&page=${page}`\n\t\t\tss = java.get(url,{\t'user-agent': ua});\n\t\t}\n\t\t\n\t\telse if (page == 1) {\n\t\tlet body = `searchtype=all&searchkey=${key}&act=search&submit=`;\n\tss = java.post(url,body,{\t'user-agent': ua});\n\t}\n\t\n\telse {\n\t\turl +=\t`?searchkey=${key}&searchtype=all&page=${page}`\n\tss = java.get(url,{\t'user-agent': ua});\n\t}\n\ncode = ss.statusCode();\nif (code == 302) {\n\t//重定向\n\tss.header(\"location\");\n\t}\nelse if (code == 200) {\n\tcache.put('8xss1', ss.body() );\n\t`data:;base64,${java.base64Encode(nn)},{'type':''}`;\n\t}\nelse if (code == 520) {\n\tjava.toast(\"💔IP被拉黑\");\n\t}\nelse {\n\tjava.toast(\"💔搜索响应码异常\");\n\t}\n\n\n}\ncatch(err) {\n\tcache.put('8xbl1', source.getVariable() );\n\tsource.setVariable('');\n\turl\n\t}\n\n</js>",
  "variableComment": "♦源变量：\n　 当前书源使用的网址\n　 可点击发现页版本号手动刷新\n\n♦书籍变量：\n　 ①填写  🔒 并刷新，关闭本书评论显示\n　 ②填写“目录”并刷新，强制刷新目录\n　 ③填写分数并刷新，使用分数进行评分\n　 ④填写其它并刷新，内容作为评论发送\n分数格式示意“1分”“2分”…“10分”\n\n㊟详情页检测到有更新内容时才刷新目录(书架刷新不影响)\n\n！注意区分源变量和书籍变量\n",
  "weight": 0
}]